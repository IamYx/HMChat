import { V2NIMErrorCode, V2NIMErrorImpl } from "@nimsdk/base"; import { ModifyMessageModel } from "../../model/ModifyMessageModel"; const s41 = '[ModifyModel]'; export class ModifyModel { constructor(d59, table) { this.core = d59; this.table = table; } async queryMessage(c59) { try { const message = await this.table.queryExcludeDeleteStatus(c59); return message; } catch (e) { this.core.logger.error(s41, 'queryMessage', c59, e); if (e instanceof V2NIMErrorImpl || e.name === 'V2NIMError') { throw e; } else { throw new V2NIMErrorImpl({ code: V2NIMErrorCode.V2NIM_ERROR_CODE_UNKNOWN, detail: { reason: `queryMessage ${JSON.stringify(e)}`, rawError: e } }); } } } async updateModifyMessage(message) { try { const model = new ModifyMessageModel(message.messageClientId, message.text, message.attachment?.raw, message.serverExtension, message.subType, message.modifyTime, message.modifyAccountId); await this.table.modify(model); } catch (e) { this.core.logger.error(s41, 'updateModifyMessage', message, e); if (e instanceof V2NIMErrorImpl || e.name === 'V2NIMError') { throw e; } else { throw new V2NIMErrorImpl({ code: V2NIMErrorCode.V2NIM_ERROR_CODE_UNKNOWN, detail: { reason: `updateModifyMessage ${JSON.stringify(e)}`, rawError: e } }); } } } async getModifyTime(b59) { try { return await this.table.getModifyTime(b59); } catch (e) { this.core.logger.error(s41, 'getModifyTime', b59, e); if (e instanceof V2NIMErrorImpl || e.name === 'V2NIMError') { throw e; } else { throw new V2NIMErrorImpl({ code: V2NIMErrorCode.V2NIM_ERROR_CODE_UNKNOWN, detail: { reason: `getModifyTime ${JSON.stringify(e)}`, rawError: e } }); } } } } 